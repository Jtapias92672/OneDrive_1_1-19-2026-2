import request from 'supertest';
import express from 'express';
import { RectangleController } from '../controllers/rectangle.controller';

describe('RectangleController', () => {
  const mockService = {
    findAll: jest.fn(),
    findById: jest.fn(),
    create: jest.fn(),
    update: jest.fn(),
    delete: jest.fn(),
  };

  const controller = new RectangleController(mockService as any);

  beforeEach(() => {
    jest.clearAllMocks();
  });

  describe('getAll', () => {
    it('returns all rectangles', async () => {
      mockService.findAll.mockResolvedValue([{ id: '1' }]);
      const app = express();
      app.get('/', controller.getAll.bind(controller));

      const response = await request(app).get('/');

      expect(response.status).toBe(200);
      expect(response.body.data).toHaveLength(1);
    });
  });

  describe('getById', () => {
    it('returns rectangle by id', async () => {
      mockService.findById.mockResolvedValue({ id: '1' });
      const app = express();
      app.get('/:id', controller.getById.bind(controller));

      const response = await request(app).get('/1');

      expect(response.status).toBe(200);
      expect(response.body.data.id).toBe('1');
    });

    it('returns 404 when rectangle not found', async () => {
      mockService.findById.mockResolvedValue(null);
      const app = express();
      app.get('/:id', controller.getById.bind(controller));

      const response = await request(app).get('/nonexistent');

      expect(response.status).toBe(404);
    });
  });
});
