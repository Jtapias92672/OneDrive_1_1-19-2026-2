# MCP Gateway - Slop Tests Workflow
# Task 3.7.16: Slop Tests CI/CD Integration
# Runs after every push/PR to detect AI hallucinations and code quality issues

name: Slop Tests

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  slop-tests:
    runs-on: ubuntu-latest
    name: Run Slop Tests

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 2

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm ci

      - name: Run Slop Tests
        run: |
          chmod +x scripts/slop-tests.sh
          bash scripts/slop-tests.sh

      - name: TypeScript Check
        run: npx tsc --noEmit

      - name: Report Results
        if: always()
        run: |
          echo "## Slop Test Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          if [ $? -eq 0 ]; then
            echo " All slop tests passed" >> $GITHUB_STEP_SUMMARY
          else
            echo " Slop tests found issues - see logs above" >> $GITHUB_STEP_SUMMARY
          fi
